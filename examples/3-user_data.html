<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>jQuery consistent listbox - User data</title>

		<!-- need to include jQuery -->
		<script src="https://code.jquery.com/jquery-3.7.1.min.js" type="text/javascript" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
		<script src="https://code.jquery.com/ui/1.14.1/jquery-ui.min.js" type="text/javascript" integrity="sha256-AlTido85uXPlSyyaZNsjJXeCs07eSv3r43kyCVc8ChI=" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
		<link href="https://code.jquery.com/ui/1.14.1/themes/cupertino/jquery-ui.css" type="text/css" rel="stylesheet" media="screen"  integrity="sha256-1Lhp59o6Lo17agNDv7pxRJSu6j1iExUKwHp/P2I19hQ=" crossorigin="anonymous" referrerpolicy="no-referrer"/>

		<!-- include the plugin and default stylesheet -->
		<script src="../upload/listbox.min.js" type="text/javascript"></script>
		<link href="../upload/listbox.min.css" type="text/css" rel="stylesheet"/>

		<link href="example.css" type="text/css" rel="stylesheet"/>
		<style>
			#user-info{
				min-width: 25rem;
			}
		</style>
	</head>
<body>
		<div class="float-l">
			Singleselect listbox:
			<div id="user_listbox" class="sl-listbox sl-h-20"></div>
		</div>
		<div id="user-info" class="float-l ml-1" style="display: none;">
			<div class="field">
				<label class="control-label">Name:</label>
				<div class="control">
					<input type="text" value="" placeholder="Name" id="input-name" class="">
				</div>
			</div>
			<div class="field">
				<label class="control-label">Is premium account:</label>
				<div class="control">
					<div>
						<div class="check-val">
							<input type="radio" name="is_premium" class="check-input" value="1">
							<label>Yes</label>
						</div>
						<div class="check-val">
							<input type="radio" name="is_premium" class="check-input" value="0">
							<label>No</label>
						</div>
					</div>
				</div>
			</div>
			<div class="field">
				<label class="control-label">Account sort order:</label>
				<div class="control">
					<input type="number" min="1" step="1" value="" placeholder="Account sort order" id="input-sort-order">
				</div>
			</div>
		</div>
		<div class="float-l ml-1">
			Other examples:
			<ul>
				<li><a href="1-quick_start.html">Demo example</a>
				<li><a href="2-insert-delete.html">Item manipulations</a>
				<li><a href="3-user_data.html">User data</a>
				<li><a href="4-extended_user_data.html">Advansed user data</a>
				<li><a href="5-manual_sort.html">Manual sort</a>
				<li><a href="6-auto_sort.html">Autosort</a>
				<li><a href="7-select.html">Select and deselect example</a>
				<li><a href="8-style.html">Select and deselect example</a>
			<ul>
		</div>
		<br class="clear"><br>
	<button id="btn-data" type="button">Form data</button>

	<div id="output"></div>
	<script><!--

	var userData = [
			{id: 777, name: 'John',		is_premium: true,	sort_order: 11 },
			{id: 474, name: 'Megan',	is_premium: true,	sort_order: 22 },
			{id: 212, name: 'Jack',		is_premium: false,	sort_order: 85 },
			{id: 189, name: 'Emma',		is_premium: false,	sort_order: 100 },
			{id: 976, name: 'Alice',	is_premium: true,	sort_order: 1 },
		];

	$( function() {

		function save_previous(previous_id) {
			let old_data = $('#user_listbox').listbox('getItemData', previous_id);
			if (old_data) {
				old_data['name'] = $('#input-name').val();
				old_data['sort_order'] = parseInt($('#input-sort-order').val());
				old_data['is_premium'] = $("input:radio[name=is_premium]:checked").val() != 0;

				$('#user_listbox').listbox('updateItemData', previous_id, old_data, is_update_text = true, text_alias = 'name');
			}
		}

		function load_data(data) {
			$('#input-name').val(data ? data['name'] : '');
			$('#input-sort-order').val(data ? data['sort_order'] : 1);
			$("input:radio[name=is_premium]").prop('checked', false).filter('[value="' +  (data ? (data['is_premium'] ? '1': '0') : '0') + '"]').prop('checked', true);

			if (data) {
				$('#user-info').show();
			}
		}

		var lbItems = [];
		for (const user of userData) {
			lbItems.push({val: user.id, text: user.name, data: user});
		}


		$('#user_listbox').listbox({
			items: lbItems,
			onChange: function(e, val) {
				if (val.old) {
					save_previous(val.old);
				}
				load_data($('#user_listbox').listbox('getItemData', val.cur));
			}
		});


		$('#btn-data').on("click", function(e) {
			e.preventDefault();
			save_previous($('#user_listbox').listbox('val'));

			save_data = $('#user_listbox').listbox('getAllData', true);
			console.log(Object.values($('#user_listbox').listbox('getAllData')));

			let text = '';

			for (const user of save_data) {
				if (text) {
					text += ',<br>';
				}
				text += 'ID: <i>' + user.id + '</i>; Name: <b>`' + user.name + '`</b>; ' + 'Is premium account: <i>' + user.is_premium + '</i>; ' + 'Sort order: <i>' + user.sort_order + '</i>';
			}

			$('#output').append('<p>Listbox data:<br>' + text + '.</p>');
		});
	});
	//--></script>
</body>
</html>
