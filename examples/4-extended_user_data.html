<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>jQuery consistent listbox - User data</title>

		<!-- need to include jQuery -->
		<script src="https://code.jquery.com/jquery-3.7.1.min.js" type="text/javascript" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
		<script src="https://code.jquery.com/ui/1.14.1/jquery-ui.min.js" type="text/javascript" integrity="sha256-AlTido85uXPlSyyaZNsjJXeCs07eSv3r43kyCVc8ChI=" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
		<link href="https://code.jquery.com/ui/1.14.1/themes/cupertino/jquery-ui.css" type="text/css" rel="stylesheet" media="screen"  integrity="sha256-1Lhp59o6Lo17agNDv7pxRJSu6j1iExUKwHp/P2I19hQ=" crossorigin="anonymous" referrerpolicy="no-referrer"/>

		<!-- include the plugin and default stylesheet -->
		<script src="../upload/listbox.min.js" type="text/javascript"></script>
		<link href="../upload/listbox.min.css" type="text/css" rel="stylesheet"/>

		<link href="example.css" type="text/css" rel="stylesheet"/>
		<style>
			#user-info{
				min-width: 25rem;
			}
		</style>
	</head>
<body>
		<div class="float-l">
			Singleselect listbox:
			<div id="user_listbox" class="sl-listbox sl-h-20"></div>
		</div>
		<div id="user-info" class="float-l ml-1" style="display: none;">
			<div class="field">
				<label class="control-label">Name:</label>
				<div class="control">
					<input type="text" value="" placeholder="Name" id="input-name" class="">
				</div>
			</div>
			<div class="field">
				<label class="control-label">Is premium account:</label>
				<div class="control">
					<div>
						<div class="check-val">
							<input type="radio" name="is_premium" class="check-input" value="1">
							<label>Yes</label>
						</div>
						<div class="check-val">
							<input type="radio" name="is_premium" class="check-input" value="0">
							<label>No</label>
						</div>
					</div>
				</div>
			</div>
			<div class="field">
				<label class="control-label">Account sort order:</label>
				<div class="control">
					<input type="number" min="1" step="1" value="" placeholder="Account sort order" id="input-sort-order">
				</div>
			</div>
		</div>
		<div class="float-l ml-1">
			Other examples:
			<ul>
				<li><a href="1-quick_start.html">Demo example</a>
				<li><a href="2-insert-delete.html">Item manipulations</a>
				<li><a href="3-user_data.html">User data</a>
				<li><a href="4-extended_user_data.html">Advansed user data</a>
				<li><a href="5-manual_sort.html">Manual sort</a>
				<li><a href="6-auto_sort.html">Autosort</a>
				<li><a href="7-select.html">Select and deselect example</a>
				<li><a href="8-style.html">Ð¡ustomizing the appearance</a>
			<ul>
		</div>
		<br class="clear"><br>
	<button id="btn-data" type="button">Form data</button>&nbsp;
	<button id="btn-replace" type="button">Replace data</button>&nbsp;
	<button id="btn-unset" type="button">Unset data prop</button>

	<div id="output"></div>
	<script><!--

	var userData = [
			{id: 777, name: 'John',		is_premium: true,	sort_order: 11,		extra_field: 555},
			{id: 474, name: 'Megan',	is_premium: true,	sort_order: 22,		extra_field: 111},
			{id: 212, name: 'Jack',		is_premium: false,	sort_order: 85,		extra_field: 333},
			{id: 189, name: 'Emma',		is_premium: false,	sort_order: 100,	extra_field: 444},
			{id: 976, name: 'Alice',	is_premium: true,	sort_order: 1,		extra_field: 888},
		];
	var bella = {id: 5, name: 'Bella',	is_premium: false,	sort_order: 75,	extra_field: 222};

	$( function() {

		function save_previous(previous_id) {
			if ($('#user_listbox').listbox('hasItem', previous_id)) {
				let text = $('#input-name').val();
				$('#user_listbox').listbox('setItemText', previous_id, text);
				$('#user_listbox').listbox('setItemDataVar', previous_id, 'name', text);
				$('#user_listbox').listbox('setItemDataVar', previous_id, 'sort_order', $('#input-sort-order').val());
				$('#user_listbox').listbox('setItemDataVar', previous_id, 'is_premium', $("input:radio[name=is_premium]:checked").val() != 0);
			}
		}

		function load_data() {
			if ($('#user_listbox').listbox('hasSelected')) {
				$('#input-name').val($('#user_listbox').listbox('getText'));
				$('#input-sort-order').val($('#user_listbox').listbox('getSortOrder'));
				$("input:radio[name=is_premium]").prop('checked', false).filter('[value="' +  ($('#user_listbox').listbox('getDataVar', 'is_premium') ? '1': '0') + '"]').prop('checked', true);
				$('#user-info').show();
			} else {
				$('#user-info').hide();
			}
		}

		var lbItems = [];
		for (const user of userData) {
			lbItems.push({val: user.id, text: user.name, data: user});
		}

		$('#user_listbox').listbox({
			items: lbItems,
			onChange: function(e, val) {
				if (val.old) {
					save_previous(val.old);
				}
				load_data();
			}
		});

		$('#btn-data').on("click", function(e) {
			e.preventDefault();
			save_previous($('#user_listbox').listbox('val'));

			save_data = $('#user_listbox').listbox('getAllData', true);
			console.log(Object.values($('#user_listbox').listbox('getAllData')));
			let text = '';

			for (const user of save_data) {
				if (text) {
					text += ',<br>';
				}
				text += 'ID: <i>' + user.id + '</i>; Name: <b>`' + user.name + '`</b>; ' + 'Is premium account: <i>' + user.is_premium + '</i>; ' + 'Sort order: <i>' + user.sort_order + '</i>' + (user.hasOwnProperty('extra_field') ? ('; Extra field:  <i>' + user.extra_field + '</i>') : '');
			}

			$('#output').append('<p>Listbox data:<br>' + text + '.</p>');
		});

		$('#btn-replace').on("click", function(e) {
			e.preventDefault();
			if ($('#user_listbox').listbox('hasSelected')) {
				$(this).prop('disabled', true);
				$('#user_listbox').listbox('setVal', bella.id);
				$('#user_listbox').listbox('replaceData', bella, true, 'name');
				load_data();
			}
		});

		$('#btn-unset').on("click", function(e) {
			e.preventDefault();
			$('#user_listbox').listbox('unsetDataVar', 'extra_field');
		});
	});
	//--></script>
</body>
</html>
